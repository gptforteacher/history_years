
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Счёт лет в истории — интерактив</title>
  <meta name="description" content="Всемирная история 5 класс: лента времени, конвертер дат, мини-игры по хронологии и римским цифрам." />
  <!-- Tailwind CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(ellipse at center, #f2e9d0 0%, #ead9b7 60%, #e3cfab 100%);
      min-height: 100vh;
    }
    .tick:after { content: ""; display: block; width: 2px; height: 8px; background: #8a6f3d; margin: 2px auto 0; }
    .event-dot { position: absolute; top: -10px; transform: translateX(-50%); }
    .event-dot .label { white-space: nowrap; background: rgba(255,255,255,0.95); border: 1px solid #d3b986; padding: 2px 6px; border-radius: 8px; font-size: 12px; color: #402d16; }
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb { background: #ccb07a; border-radius: 8px; }
    ::-webkit-scrollbar-track { background: #f4ead3; }
  </style>
</head>
<body class="antialiased">
  <div id="root"></div>

  <!-- React & Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState } = React;

    // ======= UTILITIES =======
    const romanMap = [
      [1000, "M"], [900, "CM"], [500, "D"], [400, "CD"], [100, "C"],
      [90, "XC"], [50, "L"], [40, "XL"], [10, "X"], [9, "IX"],
      [5, "V"], [4, "IV"], [1, "I"],
    ];

    function toRoman(num) {
      if (num <= 0) return "—";
      let n = num;
      let res = "";
      for (const [val, symbol] of romanMap) {
        while (n >= val) { res += symbol; n -= val; }
      }
      return res;
    }

    function centuryFromYear(year) {
      const ce = year > 0;
      const abs = Math.abs(year);
      if (abs === 0) return { ce, n: 1 };
      const n = Math.floor((abs - 1) / 100) + 1;
      return { ce, n };
    }

    function millenniumFromYear(year) {
      const ce = year > 0;
      const abs = Math.abs(year);
      if (abs === 0) return { ce, n: 1 };
      const n = Math.floor((abs - 1) / 1000) + 1;
      return { ce, n };
    }

    function parseInputYear(text, era) {
      let t = (text || "").trim().replace(/[,\\s]+/g, "");
      if (!t) return null;
      const n = Number(t);
      if (Number.isNaN(n)) return null;
      return era === "bce" ? -Math.abs(n) : Math.abs(n);
    }

    // ======= DATA =======
    const EVENTS = [
      // Античность и раньше
      { id: "pyramids", title: "Строительство пирамид (Гиза)", year: -2560 },
      { id: "olympics", title: "Первые Олимпийские игры", year: -776 },
      { id: "found_rome", title: "Основание Рима", year: -753 },
      { id: "marathon", title: "Марафонская битва", year: -490 },
      { id: "fall_nineveh", title: "Падение Ниневии", year: -612 },
      { id: "hammurabi", title: "Правление Хаммурапи (начало)", year: -1792 },
      // Рубеж эр и Средневековье
      { id: "fall_west_rome", title: "Падение Западной Римской империи", year: 476 },
      { id: "bapt_rus", title: "Крещение Руси", year: 988 },
      { id: "norman_1066", title: "Нормандское завоевание Англии", year: 1066 },
      { id: "mongol_rus", title: "Нашествие монголов на Русь", year: 1237 },
      { id: "black_death", title: "«Чёрная смерть» в Европе", year: 1347 },
      // Раннее Новое время
      { id: "printing_gutenberg", title: "Печатный станок Гутенберга", year: 1450 },
      { id: "columbus", title: "Путешествие Колумба", year: 1492 },
      { id: "vasco", title: "Васко да Гама достигает Индии", year: 1498 },
      { id: "luther", title: "95 тезисов Мартина Лютера", year: 1517 },
      // Новое время
      { id: "us_indep", title: "Декларация независимости США", year: 1776 },
      { id: "fr_rev", title: "Великая французская революция", year: 1789 },
      { id: "waterloo", title: "Битва при Ватерлоо", year: 1815 },
      // ХХ век
      { id: "ww1_start", title: "Начало Первой мировой войны", year: 1914 },
      { id: "oct_rev", title: "Октябрьская революция", year: 1917 },
      { id: "ww2_start", title: "Начало Второй мировой войны", year: 1939 },
      { id: "ww2_end", title: "Окончание Второй мировой войны", year: 1945 },
      { id: "gagarin", title: "Первый полёт человека в космос", year: 1961 },
      // Современность
      { id: "independence_rb", title: "Независимость Республики Беларусь", year: 1990 },
    ];

    const QUIZ_ROMAN = [
      { q: "1861 год н. э. — это какой век?", answer: 19 },
      { q: "1245 год н. э. — это какой век?", answer: 13 },
      { q: "500 год до н. э. — это какой век?", answer: 5, era: "bce" },
      { q: "206 год до н. э. — это какой век?", answer: 3, era: "bce" },
      { q: "480 год до н. э. — это какой век?", answer: 5, era: "bce" },
    ];

    // ======= ANTIQUE THEME =======
    const frameClass = "rounded-2xl shadow-xl border-[6px] border-[#ccb07a]/80";

    function LaurelIcon() {
      return (
        <svg viewBox="0 0 200 200" className="w-14 h-14 opacity-70">
          <g fill="none" stroke="#8a6f3d" strokeWidth="4">
            <path d="M50 160c-10-20-10-40 0-60M30 150c-6-16-6-32 0-48M70 150c-8-16-8-32 0-48" />
            <path d="M150 160c10-20 10-40 0-60M170 150c6-16 6-32 0-48M130 150c8-16 8-32 0-48" />
          </g>
        </svg>
      );
    }

    function TabButton({ active, onClick, children }) {
      return (
        <button
          onClick={onClick}
          className={
            "px-4 py-2 mx-1 rounded-full transition transform hover:-translate-y-0.5 border " +
            (active
              ? "bg-[#b08d57] text-white border-[#8a6f3d]"
              : "bg-white/70 text-[#5a4726] border-[#ccb07a] hover:bg-white")
          }
        >
          {children}
        </button>
      );
    }

    function Section({ children }) {
      return <div className={frameClass + " bg-white/70 p-4 md:p-6"}>{children}</div>;
    }

    // ======= 1) TIMELINE DRAG & DROP =======
    function DraggableCard({ evt }) {
      function onDragStart(e) { e.dataTransfer.setData("text/plain", evt.id); }
      return (
        <div
          draggable
          onDragStart={onDragStart}
          className="cursor-grab active:cursor-grabbing select-none mb-2 px-3 py-2 rounded-xl bg-white/90 border border-[#d3b986] text-[#402d16] shadow-sm"
          title={`${evt.title} (${evt.year < 0 ? Math.abs(evt.year) + " до н.э." : evt.year + " н.э."})`}
        >
          <div className="font-semibold">{evt.title}</div>
          <div className="text-sm opacity-70">
            {evt.year < 0 ? `${Math.abs(evt.year)} до н. э.` : `${evt.year} н. э.`}
          </div>
        </div>
      );
    }

    function DropZone({ label, items, onDropId }) {
      function allowDrop(e) { e.preventDefault(); }
      function onDrop(e) {
        e.preventDefault();
        const id = e.dataTransfer.getData("text/plain");
        if (id) onDropId(id);
      }
      return (
        <div
          onDragOver={allowDrop}
          onDrop={onDrop}
          className="flex-1 min-h-[220px] md:min-h-[260px] bg-[#fffaf0]/80 border-2 border-dashed border-[#bfa474] rounded-xl p-3"
        >
          <div className="text-center text-sm font-medium text-[#6b522a] mb-2">{label}</div>
          <div className="space-y-2">
            {items.map((evt) => (
              <div key={evt.id}>
                <DraggableCard evt={evt} />
              </div>
            ))}
          </div>
        </div>
      );
    }

    function TimelineBand({ allPlaced }) {
      // Expanded range to include pyramids: -3000 .. 2025
      const minYear = -3000;
      const maxYear = 2025;
      function xFromYear(y) {
        const clamped = Math.max(minYear, Math.min(maxYear, y));
        const pct = (clamped - minYear) / (maxYear - minYear);
        return pct * 100;
      }
      // Ticks every 500 years
      const ticks = [];
      for (let y = -3000; y <= 2000; y += 500) ticks.push(y);
      ticks.push(2025);

      return (
        <div className="relative mb-3 p-3 bg-[#fffaf0]/90 border border-[#d3b986] rounded-xl overflow-x-auto">
          <div className="text-center text-[#6b522a] text-sm mb-2">Лента времени (до н. э. ← 0 → н. э.)</div>
          <div className="relative h-14">
            <div className="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-1 bg-[#8a6f3d]/50 rounded"></div>
            <div className="absolute left-1/2 top-0 bottom-0 w-0.5 bg-[#8a6f3d] opacity-70"></div>
            {ticks.map((y, idx) => (
              <div key={idx} className="absolute top-0 text-[10px] text-[#5a4726]" style={{ left: xFromYear(y) + "%" }}>
                <div className="tick text-center">{y < 0 ? `${Math.abs(y)} до н. э.` : `${y} н. э.`}</div>
              </div>
            ))}
            {allPlaced.map((e) => (
              <div key={e.id} className="event-dot" style={{ left: xFromYear(e.year) + "%" }}>
                <div className="w-2 h-2 rounded-full bg-[#b08d57] border border-[#8a6f3d] mx-auto"></div>
                <div className="label mt-1">{e.title}</div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function TimelineGame() {
      const [left, setLeft] = useState([]); // BCE
      const [right, setRight] = useState([]); // CE
      const [pool, setPool] = useState(() => EVENTS.slice(0, 12));
      const [feedback, setFeedback] = useState(null);

      function moveTo(id, target) {
        const all = [...pool, ...left, ...right];
        const found = all.find((e) => e.id === id);
        if (!found) return;
        setPool((s) => s.filter((x) => x.id !== id));
        setLeft((s) => s.filter((x) => x.id !== id));
        setRight((s) => s.filter((x) => x.id !== id));
        if (target === "left") setLeft((s) => [...s, found]);
        else if (target === "right") setRight((s) => [...s, found]);
      }

      function onDropLeft(id) { moveTo(id, "left"); }
      function onDropRight(id) { moveTo(id, "right"); }

      function reset() { setLeft([]); setRight([]); setPool(EVENTS.slice(0, 12)); setFeedback(null); }

      function check() {
        let ok = true;
        let msgs = [];
        for (const e of left) if (e.year >= 0) { ok = false; msgs.push(`«${e.title}» должно быть справа (н. э.).`); }
        for (const e of right) if (e.year < 0) { ok = false; msgs.push(`«${e.title}» должно быть слева (до н. э.).`); }
        const leftYears = left.map((e) => e.year);
        const rightYears = right.map((e) => e.year);
        const isSortedAsc = (arr) => arr.every((v, i) => i === 0 || arr[i - 1] <= v);
        if (!isSortedAsc(leftYears)) { ok = false; msgs.push("Слева (до н. э.) расположите события по возрастанию лет: от более ранних к более поздним."); }
        if (!isSortedAsc(rightYears)) { ok = false; msgs.push("Справа (н. э.) расположите события по возрастанию лет: от более ранних к более поздним."); }
        setFeedback({ ok, msgs });
      }

      const placed = [...left, ...right];

      return (
        <Section>
          <div className="flex items-center justify-between mb-2">
            <h3 className="text-lg font-semibold text-[#3e2d16]">Интерактивная лента времени</h3>
            <div className="flex gap-2">
              <button onClick={reset} className="px-3 py-2 rounded-lg bg-white border border-[#ccb07a] hover:bg-[#fff7ea]">Сброс</button>
              <button onClick={check} className="px-3 py-2 rounded-lg bg-[#b08d57] text-white hover:brightness-110">Проверить</button>
            </div>
          </div>

          <TimelineBand allPlaced={placed} />

          <div className="grid md:grid-cols-3 gap-4">
            <div className="md:col-span-1">
              <div className="text-sm font-medium text-[#6b522a] mb-2">Перетащите карточки:</div>
              <div className="bg-[#fffaf0]/90 border border-[#d3b986] rounded-xl p-3 min-h-[220px]">
                {pool.map((evt) => (<DraggableCard key={evt.id} evt={evt} />))}
              </div>
            </div>
            <div className="md:col-span-2 flex gap-4 items-stretch">
              <DropZone label="До н. э." items={left} onDropId={(id)=>onDropLeft(id)} />
              <div className="w-0.5 bg-[#8a6f3d]/40 rounded-full" />
              <DropZone label="Наша эра" items={right} onDropId={(id)=>onDropRight(id)} />
            </div>
          </div>

          {feedback && (
            <div className={"mt-4 p-3 rounded-lg " + (feedback.ok ? "bg-green-50 border border-green-200" : "bg-amber-50 border border-amber-200")}>
              {feedback.ok ? (
                <div className="text-green-700 font-medium">Отлично! Классификация и порядок верные.</div>
              ) : (
                <ul className="list-disc pl-6 text-[#6b522a]">
                  {feedback.msgs.map((m, i) => (<li key={i}>{m}</li>))}
                </ul>
              )}
            </div>
          )}
        </Section>
      );
    }

    // ======= 2) DATE CONVERTER =======
    function Converter() {
      const [input, setInput] = useState(2025);
      const [era, setEra] = useState("ce");
      const year = parseInputYear(String(input), era);
      const c = year != null ? centuryFromYear(year) : null;
      const m = year != null ? millenniumFromYear(year) : null;

      return (
        <Section>
          <h3 className="text-lg font-semibold text-[#3e2d16] mb-4">Конвертер дат → века и тысячелетия</h3>
          <div className="flex flex-wrap gap-3 items-end">
            <div>
              <label className="block text-sm text-[#6b522a] mb-1">Год</label>
              <input
                className="px-3 py-2 rounded-lg border border-[#ccb07a] bg-white/80 focus:outline-none"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                placeholder="например, 1245"
              />
            </div>
            <div>
              <label className="block text-sm text-[#6b522a] mb-1">Эра</label>
              <select
                value={era}
                onChange={(e) => setEra(e.target.value)}
                className="px-3 py-2 rounded-lg border border-[#ccb07a] bg-white/80"
              >
                <option value="ce">н. э.</option>
                <option value="bce">до н. э.</option>
              </select>
            </div>
          </div>

          {year != null ? (
            <div className="mt-4 grid md:grid-cols-3 gap-3">
              <div className="p-3 bg-[#fffaf0]/90 rounded-xl border border-[#d3b986]">
                <div className="text-xs text-[#6b522a]">Нормализованная запись</div>
                <div className="text-lg font-semibold">{year < 0 ? `${Math.abs(year)} до н. э.` : `${year} н. э.`}</div>
              </div>
              <div className="p-3 bg-[#fffaf0]/90 rounded-xl border border-[#d3b986]">
                <div className="text-xs text-[#6b522a]">Век</div>
                <div className="text-lg font-semibold">{toRoman(c.n)} {c.ce ? "в. н. э." : "в. до н. э."}</div>
              </div>
              <div className="p-3 bg-[#fffaf0]/90 rounded-xl border border-[#d3b986]">
                <div className="text-xs text-[#6b522a]">Тысячелетие</div>
                <div className="text-lg font-semibold">{toRoman(m.n)} {m.ce ? "тыс. н. э." : "тыс. до н. э."}</div>
              </div>
            </div>
          ) : (
            <div className="mt-4 text-[#6b522a]">Введите корректное число года.</div>
          )}

          <div className="mt-4 text-sm text-[#6b522a]">
            Подсказка: I век н. э. — это 1–100 годы; I век до н. э. — 100–1 годы до н. э.
          </div>
        </Section>
      );
    }

    // ======= 3) EARLIER OR LATER =======
    function EarlierLater() {
      const [pair, setPair] = useState(() => pickPair());
      const [msg, setMsg] = useState(null);
      const [mode, setMode] = useState(() => (Math.random() < 0.5 ? "earlier" : "later"));

      function pickPair() {
        const a = EVENTS[Math.floor(Math.random() * EVENTS.length)];
        let b;
        do { b = EVENTS[Math.floor(Math.random() * EVENTS.length)]; } while (b.id === a.id);
        return [a, b];
      }

      function yearLabel(y) { return y < 0 ? `${Math.abs(y)} до н. э.` : `${y} н. э.`; }

      function choose(index) {
        const [a, b] = pair;
        const earlierIndex = (a.year <= b.year) ? 0 : 1;
        const laterIndex = 1 - earlierIndex;
        const correctIndex = mode === "earlier" ? earlierIndex : laterIndex;
        const ok = index === correctIndex;
        setMsg({ ok, a, b, index, correctIndex });
      }

      function next() { setPair(pickPair()); setMsg(null); setMode(Math.random() < 0.5 ? "earlier" : "later"); }

      return (
        <Section>
          <h3 className="text-lg font-semibold text-[#3e2d16] mb-2">Мини-игра «Раньше или позже?»</h3>
          <div className="text-center text-[#6b522a] mb-3 font-medium">
            Какое событие было {mode === "earlier" ? "раньше" : "позже"}?
          </div>
          <div className="grid md:grid-cols-2 gap-4">
            {pair.map((e, i) => (
              <div
                key={e.id}
                onClick={() => choose(i)}
                className="p-4 rounded-xl border bg-white/80 border-[#d3b986] cursor-pointer hover:shadow-md transition"
              >
                <div className="font-semibold mb-1">{e.title}</div>
                <div className="text-xs opacity-70">{yearLabel(e.year)}</div>
              </div>
            ))}
          </div>
          {msg && (
            <div className={"mt-4 p-3 rounded-lg " + (msg.ok ? "bg-green-50 border border-green-200" : "bg-rose-50 border border-rose-200")}>
              {msg.ok ? (
                <div className="text-green-700 font-medium">Верно!</div>
              ) : (
                <div className="text-rose-700">Не совсем.</div>
              )}
              <div className="text-[#6b522a] mt-1">
                Правильный ответ: <span className="font-medium">{mode === "earlier"
                  ? (pair[msg.correctIndex].title + " — раньше")
                  : (pair[msg.correctIndex].title + " — позже")}</span>.
              </div>
              <button onClick={next} className="mt-2 px-3 py-2 rounded-lg bg-white border border-[#ccb07a] hover:bg-[#fff7ea]">Следующая пара</button>
            </div>
          )}
        </Section>
      );
    }

    // ======= 4) ROMAN NUMERALS QUIZ (Multiple Choice) =======
    function RomanQuiz() {
      const [i, setI] = useState(0);
      const [picked, setPicked] = useState(null);
      const [feedback, setFeedback] = useState(null);
      const q = QUIZ_ROMAN[i % QUIZ_ROMAN.length];

      function buildOptions() {
        const correct = q.answer;
        const opts = new Set([correct]);
        const deltas = [-2, -1, 1, 2, 3, -3, 4, -4];
        let k = 0;
        while (opts.size < 5 && k < 100) {
          const d = deltas[Math.floor(Math.random() * deltas.length)];
          const v = Math.max(1, correct + d);
          opts.add(v);
          k++;
        }
        let v = 1;
        while (opts.size < 5) { if (!opts.has(v)) opts.add(v); v++; }
        const arr = Array.from(opts).map(n => ({ n, r: toRoman(n) }));
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const options = buildOptions();

      function pick(optIndex) {
        setPicked(optIndex);
        const isOk = options[optIndex].n === q.answer;
        setFeedback({ ok: isOk, correct: toRoman(q.answer) });
      }

      function next() {
        setI((s) => s + 1);
        setPicked(null);
        setFeedback(null);
      }

      return (
        <Section>
          <h3 className="text-lg font-semibold text-[#3e2d16] mb-4">Игра по римским цифрам</h3>
          <div className="text-[#3e2d16] mb-2">{q.q}</div>
          <div className="text-sm text-[#6b522a] mb-3">Выберите ответ:</div>
          <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
            {options.map((opt, idx) => (
              <button
                key={idx}
                onClick={() => pick(idx)}
                className={
                  "px-3 py-2 rounded-lg border transition " +
                  (picked === idx
                    ? (feedback?.ok ? "bg-green-100 border-green-300" : "bg-rose-100 border-rose-300")
                    : "bg-white/80 border-[#ccb07a] hover:bg-[#fff7ea]")
                }
              >
                {opt.r}
              </button>
            ))}
          </div>

          {feedback && (
            <div className={"mt-3 p-3 rounded-lg " + (feedback.ok ? "bg-green-50 border border-green-200" : "bg-amber-50 border border-amber-200")}>
              {feedback.ok ? (
                <div className="text-green-700 font-medium">Верно!</div>
              ) : (
                <div className="text-[#6b522a]">Правильный ответ: <span className="font-semibold">{feedback.correct}</span>.</div>
              )}
            </div>
          )}
          <button onClick={next} className="mt-3 px-3 py-2 rounded-lg bg-white border border-[#ccb07a] hover:bg-[#fff7ea]">Следующий вопрос</button>
          <div className="mt-4 text-xs text-[#6b522a]">Напоминание: I–V–X–L–C–D–M = 1,5,10,50,100,500,1000</div>
        </Section>
      );
    }

    // ======= MAIN APP =======
    function App() {
      const [tab, setTab] = useState("timeline");
      return (
        <div className="min-h-screen">
          {/* HEADER */}
          <header className="px-5 md:px-8 py-6">
            <div className={frameClass + " bg-white/60 p-4 md:p-6"}>
              <div className="flex items-center gap-4">
                <LaurelIcon />
                <div>
                  <h1 className="text-2xl md:text-3xl font-extrabold tracking-wide text-[#3e2d16] uppercase">Счёт лет в истории</h1>
                  <p className="text-[#6b522a] mt-1">
                    <a href="https://t.me/gpt_for_teacher" target="_blank" rel="noopener noreferrer"
                       className="underline decoration-dotted hover:decoration-solid hover:text-[#3e2d16]">
                      Как создавать образовательные приложения читай в Telegram‑канале <strong>GPT для учителя</strong>
                    </a>
                  </p>
                </div>
              </div>
              <div className="mt-4 flex flex-wrap items-center">
                <TabButton active={tab === "timeline"} onClick={() => setTab("timeline")}>Лента времени</TabButton>
                <TabButton active={tab === "converter"} onClick={() => setTab("converter")}>Конвертер дат</TabButton>
                <TabButton active={tab === "earlier"} onClick={() => setTab("earlier")}>Раньше или позже</TabButton>
                <TabButton active={tab === "roman"} onClick={() => setTab("roman")}>Римские цифры</TabButton>
              </div>
            </div>
          </header>

          {/* CONTENT */}
          <main className="px-5 md:px-8 pb-12 grid gap-6">
            {tab === "timeline" && <TimelineGame />}
            {tab === "converter" && <Converter />}
            {tab === "earlier" && <EarlierLater />}
            {tab === "roman" && <RomanQuiz />}
            <footer className="opacity-70 text-center text-xs text-[#6b522a] mt-2">
              Античный антураж: лавровые ветви, «пергаментный» фон, обрамления под бронзу.
            </footer>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
